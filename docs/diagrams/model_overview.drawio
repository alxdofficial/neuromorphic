<mxfile host="65bd71144e">
    <diagram name="Model Overview" id="model-overview">
        <mxGraphModel dx="642" dy="772" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2200" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="2" value="&lt;font style=&quot;font-size: 22px;&quot;&gt;&lt;b&gt;Neuromorphic LM — Architecture Overview&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="40" y="20" width="520" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="3" value="&lt;font color=&quot;#808080&quot; style=&quot;font-size: 11px;&quot;&gt;Single-token streaming forward pass. One token processed per call to forward_one_token().&lt;br&gt;Plasticity updates (PM commit, EM write) occur only at span boundaries (every P tokens).&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="40" y="55" width="560" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="4" value="&lt;table style=&quot;font-size:11px; border-collapse:collapse;&quot;&gt;&lt;tr style=&quot;background:#f0f0f0;&quot;&gt;&lt;th style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;Scaling&lt;/th&gt;&lt;th style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;Tier A (Debug)&lt;/th&gt;&lt;th style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;Tier B (Target)&lt;/th&gt;&lt;th style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;Tier C (Strong)&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;D&lt;/b&gt; (model width)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;512&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;768&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;1024&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;B&lt;/b&gt; (parallel blocks)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;4&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;6&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;L&lt;/b&gt; (layers / block)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;8&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;12&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;24&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;D_h&lt;/b&gt; (= D/B)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;128&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;128&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;128&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;PM instances&lt;/b&gt; (B×L)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;32&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;72&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;192&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;EM instances&lt;/b&gt; (B)&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;4&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;6&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;8&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;background:#f0f0f0;&quot;&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc;&quot;&gt;&lt;b&gt;~Params&lt;/b&gt;&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;~50M&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;~150M&lt;/td&gt;&lt;td style=&quot;padding:4px 8px; border:1px solid #ccc; text-align:center;&quot;&gt;~350M&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;" style="text;html=1;align=left;verticalAlign=top;resizable=0;points=[];autosize=1;strokeColor=#ccc;fillColor=#fafafa;rounded=1;" parent="1" vertex="1">
                    <mxGeometry x="950" y="20" width="520" height="220" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;Legend&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="950" y="260" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="6" value="Working Memory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="950" y="285" width="120" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="Procedural Memory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1080" y="285" width="130" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="Episodic Memory" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1220" y="285" width="120" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="Neuromodulator" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1350" y="285" width="100" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="20" value="&lt;b&gt;token_id&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#808080&quot;&gt;[BS]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="470" y="130" width="160" height="45" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="&lt;b&gt;Embedding&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#808080&quot;&gt;nn.Embedding(vocab, D)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="445" y="210" width="210" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="20" target="21" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="&lt;font color=&quot;#4a86c8&quot; style=&quot;font-size: 10px;&quot;&gt;x [BS, D]&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="530" y="268" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="&lt;b&gt;Working Memory&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;1 shared instance&lt;br&gt;Sliding window attention&lt;br&gt;W=256 slots, D_wm=128, 4 heads&lt;br&gt;Ring buffer K/V cache&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="120" y="340" width="280" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="31" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;fontSize=10;" parent="1" source="21" target="30" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="550" y="295"/>
                            <mxPoint x="260" y="295"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="32" value="&lt;font color=&quot;#4a86c8&quot; style=&quot;font-size: 10px;&quot;&gt;y_wm [BS, D]&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="200" y="438" width="90" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="33" value="&lt;b&gt;W_in&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;nn.Linear(D, D)&lt;br&gt;Input projection&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="660" y="345" width="200" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="34" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;fontSize=10;" parent="1" source="21" target="33" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="550" y="295"/>
                            <mxPoint x="760" y="295"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="35" value="&lt;b&gt;Reshape&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;[BS, D] → [BS, B, D_h]&lt;br&gt;Split across B blocks&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="650" y="440" width="220" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="33" target="35" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="40" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#999999;dashed=1;strokeWidth=2;verticalAlign=top;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="50" y="530" width="1340" height="860" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="&lt;font style=&quot;font-size: 13px;&quot;&gt;&lt;b&gt;×B Parallel Blocks&lt;/b&gt;  &lt;font color=&quot;#888&quot;&gt;(B=4 / 6 / 8 depending on tier)&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="60" y="535" width="500" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="42" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;dashed=0;strokeColor=#6c8ebf;" parent="1" source="30" target="40" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="260" y="520" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="260" y="480"/>
                            <mxPoint x="260" y="530"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="43" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="35" target="40" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="760" y="520" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="760" y="510"/>
                            <mxPoint x="760" y="530"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="50" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#aaaaaa;strokeWidth=1;verticalAlign=top;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="80" y="575" width="560" height="790" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="&lt;font style=&quot;font-size: 12px;&quot;&gt;&lt;b&gt;Block b&lt;/b&gt;  &lt;font color=&quot;#888&quot;&gt;(expanded view — 1 of B)&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="90" y="580" width="350" height="25" as="geometry"/>
                </mxCell>
                <mxCell id="52" value="&lt;b&gt;Episodic Memory Retrieve&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;1 EM bank per block (B total)&lt;br&gt;query from concat(x, y_wm) → top-k → cross-attn&lt;br&gt;M=256 slots, D_em=128, k_ret=4&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="100" y="620" width="310" height="75" as="geometry"/>
                </mxCell>
                <mxCell id="53" value="&lt;b&gt;W_wm_proj&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;D → D_h&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="440" y="620" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="54" value="&lt;b&gt;W_em_proj&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;D → D_h&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="440" y="670" width="110" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="55" value="&lt;font color=&quot;#6c8ebf&quot; style=&quot;font-size: 9px;&quot;&gt;y_wm_proj [D_h]&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="555" y="628" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="56" value="&lt;font color=&quot;#d6b656&quot; style=&quot;font-size: 9px;&quot;&gt;y_em_proj [D_h]&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="555" y="678" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="60" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#bbbbbb;dashed=1;strokeWidth=1;verticalAlign=top;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="100" y="740" width="520" height="590" as="geometry"/>
                </mxCell>
                <mxCell id="61" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;×L Sequential Layers&lt;/b&gt;  &lt;font color=&quot;#888&quot;&gt;(L=8 / 12 / 24)&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="110" y="745" width="340" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="62" value="&lt;font color=&quot;#666&quot; style=&quot;font-size: 10px;&quot;&gt;x_block [BS, D_h]&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="100" y="718" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="70" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#aaaaaa;strokeWidth=1;verticalAlign=top;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="120" y="775" width="480" height="250" as="geometry"/>
                </mxCell>
                <mxCell id="71" value="&lt;font style=&quot;font-size: 11px;&quot;&gt;&lt;b&gt;Layer ℓ&lt;/b&gt;  &lt;font color=&quot;#888&quot;&gt;(1 of L per block)&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="130" y="780" width="260" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="72" value="&lt;b&gt;PM Apply&lt;/b&gt; (read-only)&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;1 PM per layer per block (B×L total)&lt;br&gt;r=8 slots: pm_K, pm_V, pm_a&lt;br&gt;y_pm = (pm_a ⊙ scores) @ pm_V&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="140" y="810" width="220" height="70" as="geometry"/>
                </mxCell>
                <mxCell id="73" value="&lt;b&gt;Fuse Inputs&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;u = concat(x_block, y_pm, y_wm_proj, y_em_proj, surprise)&lt;br&gt;input_dim = 4×D_h + 1&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="140" y="895" width="340" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="74" value="&lt;b&gt;Affine Recurrence&lt;/b&gt; (scan-friendly)&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;a = σ(W_a · u)&amp;nbsp;&amp;nbsp;&amp;nbsp;b = tanh(W_b · u)&lt;br&gt;h_t = a ⊙ (carry · h_{t−1}) + b&lt;br&gt;output = LayerNorm(h_t + x_block)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#333333;fontSize=10;strokeWidth=2;" parent="1" vertex="1">
                    <mxGeometry x="140" y="958" width="340" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="75" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;strokeColor=#82b366;" parent="1" source="72" target="73" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;" parent="1" source="73" target="74" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="77" value="&lt;b&gt;Eligibility Update&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#555&quot;&gt;Per token (differentiable):&lt;br&gt;elig_K = ρ · elig_K + k_cand&lt;br&gt;elig_V = ρ · elig_V + v_cand&lt;br&gt;&lt;i&gt;(Committed at span boundary)&lt;/i&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="390" y="810" width="195" height="75" as="geometry"/>
                </mxCell>
                <mxCell id="80" value="&lt;font style=&quot;font-size: 18px;&quot; color=&quot;#888&quot;&gt;⋮&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot;&gt;(L layers total)&lt;/font&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="300" y="1040" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="81" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;Layer output →&lt;br&gt;feeds next layer as x_block&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;strokeColor=none;fillColor=none;fontColor=#888888;" parent="1" vertex="1">
                    <mxGeometry x="310" y="1013" width="150" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;At Span Boundary (every P tokens):&lt;/b&gt;&lt;br&gt;PMNeuromodulator → commit_mask, λ, g, slots → PM commit&lt;br&gt;EMNeuromodulator → write_mask, g_em → EM write&lt;br&gt;&lt;font color=&quot;#888&quot;&gt;Within spans: PM and EM are &lt;b&gt;read-only&lt;/b&gt;&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="120" y="1100" width="280" height="65" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;surprise&lt;/b&gt;&lt;br&gt;[BS, 1]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="500" y="930" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="84" value="&lt;font color=&quot;#444&quot; style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;h_b [BS, D_h]&lt;/b&gt;&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="290" y="1180" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="90" value="&lt;b&gt;Block 1&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#888&quot;&gt;Same structure:&lt;br&gt;1 EM bank&lt;br&gt;L layers (each with PM)&lt;br&gt;EMNeuromodulator&lt;br&gt;L × PMNeuromodulator&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#aaaaaa;fontSize=11;verticalAlign=middle;" parent="1" vertex="1">
                    <mxGeometry x="680" y="575" width="180" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="91" value="&lt;b&gt;Block 2&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#888&quot;&gt;...&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#aaaaaa;fontSize=11;verticalAlign=middle;" parent="1" vertex="1">
                    <mxGeometry x="880" y="575" width="130" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="92" value="&lt;font style=&quot;font-size: 22px;&quot; color=&quot;#999&quot;&gt;···&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="1020" y="630" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="93" value="&lt;b&gt;Block B−1&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#888&quot;&gt;...&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fafafa;strokeColor=#aaaaaa;fontSize=11;verticalAlign=middle;" parent="1" vertex="1">
                    <mxGeometry x="1090" y="575" width="140" height="150" as="geometry"/>
                </mxCell>
                <mxCell id="94" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;Instance Counts:&lt;/b&gt;&lt;br&gt;WM: 1 (shared across all blocks)&lt;br&gt;EM: B instances (1 per block)&lt;br&gt;PM: B × L instances (1 per layer per block)&lt;br&gt;Recurrent h: B × L instances&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff;strokeColor=#cccccc;fontSize=10;align=left;verticalAlign=top;spacingLeft=8;spacingTop=4;" parent="1" vertex="1">
                    <mxGeometry x="680" y="760" width="260" height="85" as="geometry"/>
                </mxCell>
                <mxCell id="100" value="&lt;b&gt;Concatenate Block Outputs&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;[h_0, h_1, ..., h_{B-1}] → [BS, D]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="380" y="1420" width="300" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="101" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="40" target="100" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="102" value="&lt;font color=&quot;#4a86c8&quot; style=&quot;font-size: 10px;&quot;&gt;h_final [BS, D]&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="480" y="1475" width="100" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="103" value="&lt;b&gt;LM Head&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;nn.Linear(D, vocab)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="420" y="1520" width="220" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="104" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="100" target="103" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="105" value="&lt;font color=&quot;#4a86c8&quot; style=&quot;font-size: 10px;&quot;&gt;logits [BS, vocab]&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="475" y="1575" width="110" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="110" value="&lt;b&gt;Surprise Signal&lt;/b&gt;&lt;br&gt;&lt;font style=&quot;font-size: 10px;&quot; color=&quot;#555&quot;&gt;surprise = −log p(target)&lt;br&gt;[BS, 1] — fed to all layers next step&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="400" y="1620" width="260" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="111" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=10;" parent="1" source="103" target="110" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="112" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;fontSize=9;dashed=1;strokeColor=#d6b656;exitX=1;exitY=0.5;entryX=1;entryY=1;" parent="1" source="110" target="40" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1430" y="1648"/>
                            <mxPoint x="1430" y="1390"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="113" value="&lt;font style=&quot;font-size: 9px;&quot; color=&quot;#d6b656&quot;&gt;surprise fed to&lt;br&gt;all layers at t+1&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;strokeColor=none;fillColor=none;" parent="1" vertex="1">
                    <mxGeometry x="1432" y="1490" width="100" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="120" value="&lt;font style=&quot;font-size: 10px;&quot;&gt;&lt;b&gt;Training Loop:&lt;/b&gt;&lt;br&gt;TBPTT segment: T tokens (e.g. 256)&lt;br&gt;Plasticity span: P tokens (e.g. 32)&lt;br&gt;T/P = 8 spans per TBPTT segment&lt;br&gt;&lt;br&gt;&lt;b&gt;Phased Training:&lt;/b&gt;&lt;br&gt;A: WM only&lt;br&gt;B: WM + PM&lt;br&gt;C: WM + PM + EM&lt;br&gt;D: + RL controllers&lt;br&gt;E: + lifelong (PM/EM persist across docs)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f0f0ff;strokeColor=#9999cc;fontSize=10;align=left;verticalAlign=top;spacingLeft=8;spacingTop=4;" parent="1" vertex="1">
                    <mxGeometry x="950" y="1420" width="300" height="175" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>